<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Calcium Test</title>
	<link rel="stylesheet" href="dist/ca.css">
	<link rel="stylesheet" href="test.css">
</head>
<body>
	<ul class="ca-container">

		<!-- Home -->
		<li class="ca-page" route="/">
			<span bind="data.greeting to textContent"></span>

			<div visible-if="data.loggedIn" class="welcome-box">
				<p>Hello, <span bind="data.user.username to textContent"></span>!</p>
				Not you? <button bind="methods.logout to click">Log Out</button>

				<button bind="methods.addFood to click">Add food</button>

				<ul class="foodlist">
					<li for-each="food in data.user.favoriteFoods">
						<span bind="textContent: food" />
					</li>
				</ul>
			</div>

			<div visible-if="!data.loggedIn">
				<p>Hey there! You aren't logged in. Why not <a href="/login" data-ca-link>log in?</a></p>
			</div>
		</li>

		<!-- Login -->
		<li class="ca-page" route="/login">
			<span>Please log in</span>

			<form class="login-form" bind="submit: methods.login">
				<label for="login-name">Username</label>
				<input type="text" id="login-name">

				<input type="submit" value="Log In">
			</form>

			<a href="/" data-ca-link>Back to home</a>

		</li>

		<!-- 404 -->
		<li class="ca-page" data-ca-route="*">
			<span>Page not found!</span>
			<a href="/" data-ca-link>Return to home!</a>
		</li>

	</ul>

	<script src="dist/ca.js"></script>

	<script>
		Ca.models.data = {
			greeting: 'Hello! this is from the "data" model.',
			loggedIn: false,
			user: null,
		}

		Ca.models.methods = {
			login: function() {
				var data = Ca.models.data;

				var username = document.getElementById('login-name').value;

				console.log('logging in as '+username);

				data.loggedIn = true;
				data.user = {
					username: username,
					favoriteFoods: []
				};

				Ca.router.go('/');
			},

			logout: function() {
				var data = Ca.models.data;

				document.getElementById('login-name').value = '';
				data.loggedIn = false;
				data.user = null;
			},

			talk: function() {
				alert('Hello');
			},

			addFood: function() {
				console.log("adding food", Ca.models.data.user.favoriteFoods);
				Ca.models.data.user.favoriteFoods.push((Math.random() * 1000).toFixed(0));
			}
		}
	</script>
</body>
</html>
